<!DOCTYPE html>
<html lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Zor.bio threejs draft</title>
        <link rel="stylesheet" href="./css/main.css"/>

    </head>

    <body>

        <div id="gameAreaWrapper" style="display:none;">
            <canvas id="renderCanvas"></canvas>
        </div>
        <div id="startMenuWrapper">
            <div id="startMenu">
                <p>Zor.bio</p>
                <input type="text" tabindex="0" autofocus placeholder="Enter your name here" id="playerNameInput"/>
                <b class="input-error">Nick name must be alphanumeric characters only!</b>
                <br/>
                <button id="startButton">Play</button>
            </div>
        </div>
        <div id="death_screen">
            <div id="respawn">
                <p>YOU DIED!</p>
                <button id="respawnButton">Respawn</button>
            </div>
        </div>

        <script type="x-shader/x-vertex" id="vertexshader">

            uniform float size;
            uniform vec3 spherePos;

            attribute vec3 ca;
            attribute float respawning;

            varying vec3 vColor;
            varying float vRespawning;
            varying float sDist;
            varying float vDist;

            void main() {

                vRespawning = respawning;
                vColor      = ca;

                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

                vDist = length( mvPosition.xyz ); // distance from camera

                sDist = length( position - spherePos ); // distance from sphere to particle

                // point size is relative to distance from camera
                gl_PointSize = size / vDist;

                gl_Position = projectionMatrix * mvPosition;

            }

        </script>

        <script type="x-shader/x-fragment" id="fragmentshader">

            uniform vec3 color;
            uniform sampler2D texture;
            uniform float FOG_ENABLED;
            uniform float FOG_FAR;

            varying vec3 vColor;
            varying float vRespawning;
            varying float sDist;

            void main() {

                float fogp = 1.0;

                // when food's respawning value is > 0.0, it's still counting
                // down to respawn
                if ( vRespawning > 0.0 ) discard;

                if ( FOG_ENABLED != 0.0 ) {
                    fogp = 1.0 - sDist / FOG_FAR;
                }

                gl_FragColor = vec4( fogp * vColor, 1.0 );

                // texture2D( texture, gl_PointCoord );

            }

        </script>

        <script type="x-shader/x-vertex" id="glowVertexShader">
            uniform vec3 viewVector;
            uniform vec3 spherePos;
            uniform vec3 mainSpherePos;
            uniform float c;
            uniform float p;

            uniform float FOG_ENABLED;

            varying float intensity;
            varying float sDist;
            varying float vDist;

            void main() {
                vec3 vNormal = normalize( normalMatrix * normal );
                vec3 vNormel = normalize( normalMatrix * viewVector );
                intensity = pow( c - dot(vNormal, vNormel), p );

                vec4 mvPosition = modelViewMatrix * vec4( spherePos, 1.0 );

                vDist = length( mvPosition.xyz );

                vec4 mMainSpherePos = modelViewMatrix * vec4( mainSpherePos, 1.0 );
                vec4 mSpherePos = modelViewMatrix * vec4( spherePos, 1.0 );

                sDist = length( mMainSpherePos - mSpherePos ); // distance from main sphere to this sphere

                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
            }
        </script>

        <script type="x-shader/x-fragment" id="glowFragmentShader">
            uniform vec3 glowColor;
            uniform float FOG_ENABLED;
            uniform float FOG_FAR;

            varying float intensity;
            varying float sDist;
            varying float vDist;

            void main() {

                float fogp = 1.0;

                if ( FOG_ENABLED != 0.0 ) {
                    fogp = 1.0 - sDist / FOG_FAR;
                }

                float strength = min( fogp, intensity );

                gl_FragColor = vec4( strength * glowColor, strength );
            }
        </script>

        <script type="x-shader/x-vertex" id="sphereVertexShader">
            uniform vec3 color;
            uniform vec3 viewVector;
            uniform vec3 mainSpherePos;
            uniform vec3 spherePos;

            uniform float FOG_ENABLED;
            uniform float FOG_FAR;

            varying float sDist;

            // void main() {
            //     // Transform vertex to view-space
            //     vec4 vViewPos = matView * rm_Vertex;

            //     // Compute the distance to character
            //     v_characterDist = length(vViewPos - u_characterPos);

            //     gl_Position = matViewProjection * rm_Vertex;
            // }
            void main() {

                vec4 mMainSpherePos = modelViewMatrix * vec4( mainSpherePos, 1.0 );
                vec4 mSpherePos = modelViewMatrix * vec4( spherePos, 1.0 );

                sDist = length( mainSpherePos - spherePos ); // distance from main sphere to this sphere

                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
            }
        </script>

        <script type="x-shader/x-fragment" id="sphereFragmentShader">
            uniform vec3 color;
            uniform float FOG_ENABLED;
            uniform float FOG_FAR;

            varying float sDist;

            void main() {

                float fogp = 1.0;

                if ( FOG_ENABLED != 0.0 ) {
                    fogp = 1.0 - sDist / FOG_FAR;
                }

                float strength = min( fogp, 0.5 );

                gl_FragColor = vec4( strength * color, strength );
            }
        </script>

        <!-- third party -->
        <script src="./bower_components/three.js/build/three.js"></script>
        <script src="./bower_components/three.js/examples/js/renderers/Projector.js"></script>
        <script src="./bower_components/three.js/examples/js/renderers/CanvasRenderer.js"></script>
        <script src="./bower_components/isMobile/isMobile.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <!-- first party -->
        <script src="./js/config.js"></script>
        <script src="./js/FollowOrbitControls.js"></script>
        <script src="./lib/util.js"></script>
        <script src="./lib/zorbio.js"></script>
        <script src="./js/ui.js"></script>
        <script src="./js/PlayerController.js"></script>
        <script src="./js/PlayerView.js"></script>
        <script src="./js/app.js"></script>
        <script src="./js/network.js"></script>

    </body>
</html>
